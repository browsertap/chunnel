#!/usr/bin/env node
var optimist = require("optimist"),
client   = require("..").client, 
cfg,
fs = require("fs")



var cfgPath = process.cwd() + "/chunnel.json";

if(fs.existsSync(cfgPath)) {
  cfg = require(cfgPath);
  var server = cfg.server;
  for(var proxy in cfg.tunnel) {
    client.connect({
      server: server,
      proxy: proxy,
      domain: cfg.tunnel[proxy]
    });
  }
} else {



  var argv = optimist.
  usage('Usage: $0 [port] [domain]').
  demand(["server"]).
  default("server", "127.0.0.1:9526").
  argv


  var portOrProxy = argv._.shift() || "localhost:8080",
  domain = argv._.shift() || "localhost",
  proxy;

  if(~String(portOrProxy).indexOf(":")) {
    proxy = portOrProxy;
  } else {
    proxy = "127.0.0.1:" + portOrProxy;
  }

  client.connect({
    server: argv.server,
    domain: domain,
    proxy: proxy
  }); 
}




